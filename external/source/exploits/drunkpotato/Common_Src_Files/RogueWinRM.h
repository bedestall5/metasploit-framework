#pragma once

#include <wchar.h>
#include <assert.h>


struct _THREAD_PARAMETERS;
typedef struct _THREAD_PARAMETERS
{
	wchar_t* listen_port;
	LocalNegotiator* negotiator;
	BOOL debug;
} THREAD_PARAMETERS;

enum _createProcessMethod;
typedef enum _createProcessMethod
{
	WITH_TOKEN,
	AS_USER,
	UNAUTHORIZED
} createProcessMethod;


int	RunRogueWinRM(char* shellcode, BOOL debug);
static wchar_t* getPowershellPath();
static createProcessMethod determineProcessLaunchingMethod(HANDLE hToken);
static BOOL EnablePriv(HANDLE hToken, LPCTSTR priv);
static int IsTokenSystem(HANDLE tok);
static BOOL isBitsRunning(void);
static BOOL triggerBits(void);
