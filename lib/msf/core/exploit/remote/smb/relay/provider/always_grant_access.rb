module Msf::Exploit::Remote::SMB::Relay::Provider
  # An override for the default RubySMB NTLM Authenticator to always grant access,
  # regardless of the provided credentials
  class AlwaysGrantAccessAuthenticator < ::RubySMB::Gss::Provider::NTLM::Authenticator
    def process_ntlm_type3(type3_msg)
      # Override the ntlm type3 validation as the current implementation of the
      # parent class validates user accounts, and doesn't support logging in without valid creds
      ::WindowsError::NTStatus::STATUS_SUCCESS
    end
  end

  #
  # An override for the default RubySMB NTLM Provider to always grant access,
  # regardless of the provided credentials
  class AlwaysGrantAccess < ::RubySMB::Gss::Provider::NTLM
    def new_authenticator(server_client)
      AlwaysGrantAccessAuthenticator.new(self, server_client)
    end
  end
end
