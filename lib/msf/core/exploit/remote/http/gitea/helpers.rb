# -*- coding: binary -*-

module Msf::Exploit::Remote::HTTP::Gitea::Helpers
  # Helper methods are private and should not be called by modules

  private

  # Returns CSRF token string for Gitea session
  #
  # @param res [Rex::Proto::Http::Response] Rex HTTP Response object
  # @return [String,nil] csrf token if found, nil otherwise
  def gitea_get_csrf(res)
    res&.get_cookies&.split('; ')&.grep(/_csrf=/)&.join&.split('=')&.last
  end

  # Returns the POST data for a Gitea login request
  #
  # @param user [String] Username
  # @param pass [String] Password
  # @param csrf [String] login csrf
  # @return [Hash] The post data for vars_post Parameter
  def gitea_helper_login_post_data(user, pass, csrf)
    post_data = {
      'user_name' => user,
      'password' => pass,
      '_csrf' => csrf
    }
    post_data
  end
end
