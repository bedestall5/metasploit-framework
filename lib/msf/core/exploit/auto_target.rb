
module Msf
  module Exploit::AutoTarget

    def auto_target?
      selected_target = targets[target_index]
      if selected_target.name =~ /Automatic/
        true
      else
        false
      end
    end

    def select_target
      return nil unless auto_target?
      host_record = target_host
      return nil if host_record.nil?

    end

    def target_host
      return nil unless self.respond_to?(:rhost)
      return nil unless framework.db.active
      current_workspace = framework.db.find_workspace(self.workspace)
      current_workspace.hosts.where(address: rhost).first
    end

    def filter_by_os_name(host_record)
      filtered_targets = targets.collect do |target|
        if target =~ host_record.os_name
          target
        else
          nil
        end
      end
    end
  end
end