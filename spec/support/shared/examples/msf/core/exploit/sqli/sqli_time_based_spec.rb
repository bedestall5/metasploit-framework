RSpec.shared_examples 'TimeBasedBlind' do |sqli_class|
  let(:timebased_class) do
    sqli_class
  end
  let(:datastore) do
    { 'SqliDelay' => 1.0 }
  end
  let(:sqli_obj) do
    creation_time = Time.now
    timebased_class.new(datastore, {}, {}) do |payload|
      delay = payload[/\d+(?:.?\d*)?/].to_f
      allow(Time).to receive(:now).and_return(creation_time + delay)
    end
  end
  context '#blind_request' do
    it "Should return true if the block takes more than datastore['SqliDelay'] to run" do
      expect(sqli_obj.send(:blind_request, 'sleep(1.3)')).to eql true
      expect(sqli_obj.send(:blind_request, 'sleep(0.5)')).to eql false
      expect(sqli_obj.send(:blind_request, 'sleep(0)')).to eql false
    end
  end
end
