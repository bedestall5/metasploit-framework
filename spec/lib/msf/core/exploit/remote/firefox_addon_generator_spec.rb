require 'spec_helper'
require 'msf/core'

RSpec.describe Msf::Exploit::Remote::FirefoxAddonGenerator do
  let(:datastore) { { 'TARGET' => 0 } }
  let(:jar) { double(:pack => '@JAR@', :build_manifest => nil) }
  let(:payload) { double(:encoded => '@EXE@', :encoded_jar => jar) }
  let(:framework) { double(:nops => nil) }
  let(:cli) { double }

  subject(:mod) do
    mod = Msf::Exploit::Remote.allocate
    mod.extend described_class
    mod.extend Msf::Exploit::Remote::BrowserExploitServer
    mod.send(:initialize, {})

    allow(mod).to receive(:datastore).and_return(datastore)
    allow(mod).to receive(:framework).and_return(framework)
    allow(mod).to receive(:payload).and_return(payload)
    allow(mod).to receive(:regenerate_payload).and_return(payload)
  end

  describe '#generate_addon_xpi' do
    let(:xpi) { mod.generate_addon_xpi(cli) }

    it { should respond_to :generate_addon_xpi }

    it 'should return an instance of Rex::Zip::Archive' do
      expect(xpi).to be_kind_of Rex::Zip::Archive
    end
  end
end
