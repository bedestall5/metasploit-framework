# -*- coding:binary -*-
require 'spec_helper'

require 'rex/java/serialization'
require 'rex/proto/rmi'
require 'msf/core/exploit/java/rmi/client'
require 'stringio'

RSpec.describe Msf::Exploit::Remote::Java::Rmi::Client::Jmx::Server do
  subject(:instance) {
    klass.new
  }

  let(:klass) {
    Class.new(Msf::Exploit) do
      include Msf::Exploit::Remote::Java::Rmi::Client
    end
  }

  describe "#send_new_client" do
    context "when there is an RMIServerImpl_Stub interface" do
      include_context "Msf::StringIO"

      #
      # lets
      #

      let(:remote_address) {
        '172.16.158.132'
      }

      it "returns the reference information" do
        expect(instance.send_new_client(sock: io)[:address]).to eq(remote_address)
      end
    end
  end

end

