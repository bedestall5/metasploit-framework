#!/bin/bash

build () {
  CC=$1
  TARGET_SUFFIX=$2
  CFLAGS=$3

  echo "[*] Building for ${TARGET_SUFFIX}..."
  for type in {shellcode,system,findsock}
   do ${CC} ${CFLAGS} -Wall -Werror -fPIC samba-root-${type}.c -shared -o samba-root-${type}-${TARGET_SUFFIX}.so
  done
}

rm -f *.o *.so *.gz

# x86
build "gcc" "x86_64" "-m64"
build "gcc" "x86" "-m32"

# ARM
build "arm-linux-gnueabi-gcc-5" "armel" "-march=armv5 -mlittle-endian"
build "arm-linux-gnueabihf-gcc-5" "armhf" "-march=armv7 -mlittle-endian"
build "aarch64-linux-gnu-gcc-4.9" "aarch64" ""

# MIPS
build "mips-linux-gnu-gcc-5" "mips" ""
build "mipsel-linux-gnu-gcc-5"  "mipsel" ""
build "mips64-linux-gnuabi64-gcc-5"  "mips64" ""
build "mips64el-linux-gnuabi64-gcc-5" "mips64el" ""

# SPARC
build "sparc64-linux-gnu-gcc-5" "sparc64" ""
build "sparc64-linux-gnu-gcc-5" "sparc" "-m32"

# PowerPC
build "powerpc-linux-gnu-gcc-5" "powerpc" ""
build "powerpc64-linux-gnu-gcc-5" "powerpc64" ""
build "powerpc64le-linux-gnu-gcc-4.9" "powerpc64le" ""

# S390X
build "s390x-linux-gnu-gcc-5" "s390x" ""

gzip -9 *.so
rm -f *.o *.so
