msfbase = __FILE__
while File.symlink?(msfbase)
  msfbase = File.expand_path(File.readlink(msfbase), File.dirname(msfbase))
end
$:.unshift(File.expand_path(File.join(File.dirname(msfbase), '..', '..', 'lib')))

require 'metasploit/framework/obfuscation/crandomizer'

fake_function_size = rand(0..3)
fake_function_collection = Metasploit::Framework::Obfuscation::CRandomizer::CodeFactory::FakeFunctionCollection.new(fake_function_size)

template = %Q|
#define MSG "BLAH"

void printf(const char*);

void test() {
  printf(MSG);
}

int main() {
  return 0;
}|

p = Metasploit::Framework::Obfuscation::CRandomizer::Parser.new(90)
result = p.parse(template)
puts result